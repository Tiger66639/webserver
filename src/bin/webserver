#!/usr/bin/php
<?php

define('WEBSERVER_BASEDIR', __DIR__ . '/../');
define('WEBSERVER_AUTOLOADER', WEBSERVER_BASEDIR . '../vendor/autoload.php);

require WEBSERVER_AUTOLOADER;;


// read in configuration
// $mainConfiguration = new \TechDivision\WebServer\MainJsonConfiguration(WEBSERVER_BASEDIR . 'etc/webserver.json');
$mainConfiguration = new \TechDivision\WebServer\MainXmlConfiguration(WEBSERVER_BASEDIR . 'etc/webserver.xml');

// init server array
$servers = array();

// start servers
foreach ($mainConfiguration->getServerConfigs() as $serverConfig) {
    $serverType = $serverConfig->getType();
    $servers[] = new $serverType($serverConfig);
}

// wait for servers
foreach ($servers as $server) {
    $server->join();
}